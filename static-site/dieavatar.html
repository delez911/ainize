<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数智员工超空间设备设计</title>
    <!-- 移除不存在的Slidev库引用 -->
    <!-- 引入Marked.js作为Markdown解析器 -->
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Shiki高亮器 -->
    <script src="https://cdn.jsdelivr.net/npm/shiki"></script>
    <!-- 引入DOMPurify用于安全处理HTML -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
    <style>
        /* 基础样式 */
        body {
            font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif, "Microsoft YaHei", "微软雅黑";
            background-color: #121212;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1IiBoZWlnaHQ9IjUiPgo8cmVjdCB3aWR0aD0iNSIgaGVpZ2h0PSI1IiBmaWxsPSIjMTIxMjEyIj48L3JlY3Q+CjxwYXRoIGQ9Ik0wIDVMNSAwWk02IDRMNCA2Wk0tMSAxTDEgLTFaIiBzdHJva2U9IiMyMjIiIHN0cm9rZS13aWR0aD0iMSI+PC9wYXRoPgo8L3N2Zz4=');
            background-repeat: repeat;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .slide-container {
            width: 100%;
            max-width: 900px;
            aspect-ratio: 16 / 9;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .slide {
            flex-grow: 1;
            padding: 1.5rem 2.5rem;
            display: none;
            flex-direction: column;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            font-size: 0.85rem;
            line-height: 1.5;
        }
        .slide.active {
            display: flex;
            opacity: 1;
        }
        h1 {
            font-size: 7rem;
            font-weight: 700;
            color: #1e3a8a;
            margin-bottom: 2rem;
            text-align: center;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.15);
            line-height: 1.1;
        }
        h2 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1e3a8a;
            margin-bottom: 0.7rem;
            border-bottom: 2px solid #dbeafe;
            padding-bottom: 0.3rem;
        }
        p, ul {
            color: #374151;
            margin-bottom: 0.6rem;
        }
        ul {
            list-style-type: disc;
            padding-left: 1.1rem;
        }
        li {
            margin-bottom: 0.3rem;
        }
        .footer {
            padding: 0.6rem 2.5rem;
            background-color: #e0e7ff;
            color: #374151;
            font-size: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        .nav-button {
            background-color: #3b82f6;
            color: white;
            padding: 0.3rem 0.7rem;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .nav-button:hover {
            background-color: #2563eb;
        }
        .nav-button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        strong {
            font-weight: 600;
            color: #1e3a8a;
        }
        /* 布局切换样式 */
        .layout-switch .layout-btn {
            display: inline-block;
            padding: 0.4rem 1.2rem;
            border-radius: 999px;
            background: linear-gradient(90deg, #60a5fa 0%, #2563eb 100%);
            color: #fff;
            font-weight: 500;
            font-size: 1rem;
            margin: 0 0.2rem;
            box-shadow: 0 2px 8px rgba(59,130,246,0.08);
            transition: background 0.3s, color 0.3s, box-shadow 0.3s;
            text-decoration: none;
            border: none;
            outline: none;
        }
        .layout-switch .layout-btn:not(.active) {
            background: #e0e7ff;
            color: #2563eb;
            box-shadow: none;
        }
        .layout-switch .layout-btn:hover {
            background: linear-gradient(90deg, #2563eb 0%, #60a5fa 100%);
            color: #fff;
            box-shadow: 0 4px 16px rgba(59,130,246,0.15);
        }
        .layout-switch .layout-btn.active {
            background: linear-gradient(90deg, #2563eb 0%, #60a5fa 100%);
            color: #fff;
            box-shadow: 0 4px 16px rgba(59,130,246,0.15);
        }
        /* 幻灯片特定样式 */
        .text-center {
            text-align: center;
        }
        .text-lg {
            font-size: 1.125rem;
        }
        .text-gray-600 {
            color: #4b5563;
        }
        .mt-4 {
            margin-top: 1rem;
        }
        .text-sm {
            font-size: 0.875rem;
        }
        .text-gray-500 {
            color: #6b7280;
        }
        .mt-10 {
            margin-top: 2.5rem;
        }
        /* 网格布局样式 */
        body.grid-layout .slide-container {
            display: block;
            height: auto;
            aspect-ratio: auto;
        }
        body.grid-layout .slide {
            display: block;
            opacity: 1;
            margin-bottom: 2rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="grid-layout">
    <div class="slide-container" data-layout-mode="grid">
        <!-- 幻灯片内容将通过JavaScript动态加载 -->
    </div>

    <div class="footer">
        <div id="pageInfo">第 1 / 1 页</div>
        <div>
            <button id="prevBtn" class="nav-button">上一页</button>
            <button id="nextBtn" class="nav-button">下一页</button>
        </div>
    </div>

    <script>
        // 获取DiEAvatar.md文件内容
        async function fetchMarkdownContent() {
            try {
                const response = await fetch('/data/DiEAvatar.md');
                if (!response.ok) {
                    throw new Error('无法加载Markdown文件');
                }
                return await response.text();
            } catch (error) {
                console.error('加载Markdown文件失败:', error);
                return '# 加载失败\n\n无法加载Markdown内容，请检查文件路径。';
            }
        }

        // 解析Markdown内容为幻灯片
        function parseMarkdownToSlides(markdown) {
            // 使用 --- 分隔符拆分幻灯片
            const slideContents = markdown.split(/^---$/m);
            
            // 处理第一个幻灯片（可能包含YAML前置内容）
            let slides = [];
            if (slideContents.length > 0) {
                // 第一个元素可能包含YAML前置内容，我们需要特殊处理
                const firstSlide = slideContents[0].trim();
                if (firstSlide.startsWith('---')) {
                    // 有YAML前置内容，需要跳过YAML部分
                    const yamlEndIndex = firstSlide.indexOf('---', 3);
                    if (yamlEndIndex !== -1) {
                        const content = firstSlide.substring(yamlEndIndex + 3).trim();
                        if (content) slides.push(content);
                    }
                } else {
                    // 没有YAML前置内容
                    if (firstSlide) slides.push(firstSlide);
                }
                
                // 添加其余幻灯片，但跳过空白幻灯片
                for (let i = 1; i < slideContents.length; i++) {
                    const content = slideContents[i].trim();
                    // 检查是否包含布局指令但没有其他内容
                    const isOnlyLayout = /^layout: .+\s*$/.test(content);
                    if (content && !isOnlyLayout) {
                        slides.push(content);
                    }
                }
            }
            
            return slides;
        }

        // 使用Marked.js进行Markdown到HTML转换
        function convertMarkdownToHTML(markdown) {
            // 配置Marked选项
            marked.setOptions({
                breaks: true,
                gfm: true
            });
            
            // 处理布局指令 - 在Markdown解析前提取布局信息
            let layoutInfo = '';
            const layoutMatch = markdown.match(/^layout: (.+)$/m);
            if (layoutMatch) {
                const layoutType = layoutMatch[1].trim();
                layoutInfo = `<div class="layout" data-layout="${layoutType}">`;
                // 从Markdown中移除布局指令行
                markdown = markdown.replace(/^layout: .+$/m, '');
            }
            
            // 处理类指令
            let classInfo = '';
            const classMatch = markdown.match(/^class: ['"]?(.*?)['"]?$/m);
            if (classMatch) {
                const className = classMatch[1].trim();
                classInfo = `<div class="custom-class" data-class="${className}">`;
                // 从Markdown中移除类指令行
                markdown = markdown.replace(/^class: ['"]?(.*?)['"]?$/m, '');
            }
            
            // 移除其他YAML样式的指令，避免它们显示为普通文本
            markdown = markdown.replace(/^[a-zA-Z]+: .+$/gm, '');
            
            // 使用DOMPurify清理HTML以防止XSS攻击
            let html = DOMPurify.sanitize(marked.parse(markdown));
            
            // 添加布局和类包装
            if (layoutInfo) {
                html = `${layoutInfo}${html}</div>`;
            }
            
            if (classInfo) {
                html = `${classInfo}${html}</div>`;
            }
            
            return html;
        }

        // 创建幻灯片HTML
        function createSlideElements(slideContents) {
            const slideContainer = document.querySelector('.slide-container');
            slideContainer.innerHTML = ''; // 清空容器
            
            // 添加布局切换按钮
            const layoutSwitch = document.createElement('div');
            layoutSwitch.className = 'layout-switch';
            layoutSwitch.style.cssText = 'display: flex; justify-content: center; gap: 1rem; margin: 1rem 0;';
            layoutSwitch.innerHTML = `
                <a href="#slide" class="layout-btn active">幻灯片模式</a>
                <a href="#grid" class="layout-btn">平铺模式</a>
            `;
            slideContainer.appendChild(layoutSwitch);
            
            // 为每个幻灯片内容创建幻灯片元素
            slideContents.forEach((content, index) => {
                const slide = document.createElement('div');
                slide.className = 'slide';
                slide.id = `slide-${index + 1}`;
                if (index === 0) slide.classList.add('active');
                
                // 使用marked.js或其他Markdown解析器处理内容
                // 这里我们简单地使用innerHTML，实际应用中应该使用安全的Markdown解析器
                slide.innerHTML = convertMarkdownToHTML(content);
                
                slideContainer.appendChild(slide);
            });
            
            return slideContainer.querySelectorAll('.slide');
        }

        // 简单的Markdown到HTML转换（实际应用中应使用成熟的Markdown解析器）
        function convertMarkdownToHTML(markdown) {
            // 配置Marked选项
            marked.setOptions({
                breaks: true,
                gfm: true
            });
            
            // 处理布局指令 - 在Markdown解析前提取布局信息
            let layoutInfo = '';
            const layoutMatch = markdown.match(/^layout: (.+)$/m);
            if (layoutMatch) {
                const layoutType = layoutMatch[1].trim();
                layoutInfo = `<div class="layout" data-layout="${layoutType}">`;
                // 从Markdown中移除布局指令行
                markdown = markdown.replace(/^layout: .+$/m, '');
            }
            
            // 处理类指令
            let classInfo = '';
            const classMatch = markdown.match(/^class: ['"]?(.*?)['"]?$/m);
            if (classMatch) {
                const className = classMatch[1].trim();
                classInfo = `<div class="custom-class" data-class="${className}">`;
                // 从Markdown中移除类指令行
                markdown = markdown.replace(/^class: ['"]?(.*?)['"]?$/m, '');
            }
            
            // 使用DOMPurify清理HTML以防止XSS攻击
            let html = DOMPurify.sanitize(marked.parse(markdown));
            
            // 添加布局和类包装
            if (layoutInfo) {
                html = `${layoutInfo}${html}</div>`;
            }
            
            if (classInfo) {
                html = `${classInfo}${html}</div>`;
            }
            
            return html;
        }

        // 初始化幻灯片
        async function initSlides() {
            const markdown = await fetchMarkdownContent();
            const slideContents = parseMarkdownToSlides(markdown);
            const slides = createSlideElements(slideContents);
            
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const pageInfo = document.getElementById('pageInfo');
            const footer = document.querySelector('.footer');
            const layoutBtns = document.querySelectorAll('.layout-btn');
            const slideContainer = document.querySelector('.slide-container'); // 修复: 定义slideContainer变量
            let currentSlideIndex = 0;
            const totalSlides = slides.length;
            
            // 更新页码信息
            function updatePageInfo() {
                pageInfo.textContent = `第 ${currentSlideIndex + 1} / ${totalSlides} 页`;
            }
            
            // 显示指定幻灯片
            function showSlide(index) {
                // 确保索引在有效范围内
                if (index < 0) {
                    index = 0;
                } else if (index >= totalSlides) {
                    index = totalSlides - 1;
                }
                
                // 隐藏所有幻灯片
                slides.forEach((slide, i) => {
                    slide.classList.remove('active');
                    // 确保在幻灯片模式下，只有当前幻灯片显示
                    if (slideContainer.dataset.layoutMode !== 'grid') {
                        slide.style.display = 'none'; 
                        slide.style.opacity = '0';
                    }
                });
                
                // 显示目标幻灯片 (仅在幻灯片模式下)
                if (slideContainer.dataset.layoutMode !== 'grid') {
                    slides[index].style.display = 'flex'; // 使用flex保持内容居中
                    slides[index].classList.add('active');
                    slides[index].style.opacity = '1';
                }
                
                currentSlideIndex = index;
                updatePageInfo();
                
                // 更新按钮状态
                prevBtn.disabled = currentSlideIndex === 0;
                nextBtn.disabled = currentSlideIndex === totalSlides - 1;
            }
            
            // 上一页按钮事件
            prevBtn.addEventListener('click', () => {
                if (currentSlideIndex > 0) {
                    slides[currentSlideIndex].classList.remove('active');
                    currentSlideIndex--;
                    showSlide(currentSlideIndex);
                }
            });
            
            // 下一页按钮事件
            nextBtn.addEventListener('click', () => {
                if (currentSlideIndex < totalSlides - 1) {
                    slides[currentSlideIndex].classList.remove('active');
                    currentSlideIndex++;
                    showSlide(currentSlideIndex);
                }
            });
            
            // 布局切换事件
            layoutBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const layout = btn.getAttribute('href').substring(1); // 'slide' or 'grid'
                    
                    layoutBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    slideContainer.dataset.layoutMode = layout; // 记录当前模式
                    
                    if (layout === 'grid') {
                        // --- 平铺模式 ---
                        document.body.classList.add('grid-layout');
                        slideContainer.style.display = 'block';
                        slideContainer.style.aspectRatio = 'auto';
                        slideContainer.style.overflowY = 'visible';
                        slideContainer.style.height = 'auto';
                        slideContainer.style.paddingBottom = '2rem';
                        
                        slides.forEach(slide => {
                            slide.style.display = 'flex';
                            slide.style.opacity = '1';
                            slide.style.marginBottom = '1.5rem';
                            slide.style.height = 'auto';
                            slide.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
                            slide.classList.remove('active');
                        });
                        
                        footer.style.display = 'none';
                        document.body.style.alignItems = 'flex-start';
                        document.documentElement.style.overflowY = 'auto';
                        document.body.style.overflowY = 'auto';
                        document.body.style.height = '100%';
                        document.body.style.minHeight = '100%';
                    } else {
                        // --- 幻灯片模式 ---
                        document.body.classList.remove('grid-layout');
                        slideContainer.style.display = 'flex';
                        slideContainer.style.aspectRatio = '16 / 9';
                        slideContainer.style.overflow = 'hidden';
                        slideContainer.style.overflowY = 'hidden';
                        slideContainer.style.height = '';
                        slideContainer.style.paddingBottom = '';
                        
                        slides.forEach(slide => {
                            slide.style.marginBottom = '';
                            slide.style.height = '';
                            slide.style.boxShadow = '';
                        });
                        
                        footer.style.display = 'flex';
                        document.body.style.alignItems = 'center';
                        document.documentElement.style.overflowY = '';
                        document.body.style.overflowY = '';
                        document.body.style.height = '';
                        showSlide(currentSlideIndex);
                    }
                });
            });
            
            // 初始化
            updatePageInfo();
            
            // 默认使用平铺模式
            document.body.classList.add('grid-layout');
            slideContainer.style.display = 'block';
            slideContainer.style.aspectRatio = 'auto';
            slideContainer.style.overflowY = 'visible';
            slideContainer.style.height = 'auto';
            slideContainer.style.paddingBottom = '2rem';
            
            slides.forEach(slide => {
                slide.style.display = 'flex';
                slide.style.opacity = '1';
                slide.style.marginBottom = '1.5rem';
                slide.style.height = 'auto';
                slide.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
                slide.classList.remove('active');
            });
            
            footer.style.display = 'none';
            document.body.style.alignItems = 'flex-start';
            document.documentElement.style.overflowY = 'auto';
            document.body.style.overflowY = 'auto';
            document.body.style.height = '100%';
            document.body.style.minHeight = '100%';
            
            // 检查URL哈希值，如果是#slide则切换到幻灯片模式
            if (window.location.hash === '#slide') {
                document.querySelector('[href="#slide"]')?.click();
            } else {
                showSlide(currentSlideIndex);
            }
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initSlides);
    </script>
</body>
</html>